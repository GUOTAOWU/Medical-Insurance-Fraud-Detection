<!-- このページは予測分析の全結果を表示する画面であり、個別の案件ごとに詐欺か正常かの判定結果を確認して必要に応じてステータスを更新できる機能に加え、
正常・異常サンプル間の統計的な差異、各特徴量と不正判定との相関関係、そしてモデルが重視した特徴量の重要度ランキングといった詳細な分析指標を一元的に参照することができます。 -->

{% extends "base.html" %}
{% block title %}审核结果{% endblock %}

{% block content %}
<div class="container py-4">

  <h2 class="mb-3">预测分析结果（共 {{ n_records }} 条）</h2>

  <!-- A. 是否欺诈明细 -->
  <h5 class="mt-4">是否欺诈明细</h5>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
    {% for cl_no, fraud in results %}
      <div class="col">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column justify-content-center align-items-center">
            <h5 class="card-title">{{ cl_no }}</h5>
            {% if fraud == '是' %}
              <span class="badge bg-danger fs-6">欺 诈</span>
            {% else %}
              <span class="badge bg-success fs-6">正 常</span>
            {% endif %}

            <form method="POST" action="{{ url_for('update_status') }}" class="mt-2">
            <input type="hidden" name="cl_no" value="{{ cl_no }}">
            <input
             type="text"
             name="new_status"
             class="form-control form-control-sm"
             placeholder="输入状态"
             value="{{ record.cl_line_status if record else '' }}"
            >
            <button type="submit" class="btn btn-warning btn-sm mt-2">更新状态</button>
            </form>


          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- B. 负面 vs 正面 样本差值 -->
  <h5 class="mt-4">负面样本 vs 正面样本 均值/标准差 差值</h5>
  <div class="table-responsive mb-5">
    {{ diff_stats | safe }}
  </div>

  <!-- C. 特征相关性 -->
  <h5 class="mt-4">特征与欺诈目标的相关性排序</h5>
  <table class="table table-striped table-hover mb-5">
    <thead>
      <tr><th>特征</th><th>相关性</th></tr>
    </thead>
    <tbody>
      {% for feat, val in corr_items %}
        <tr>
          <td>{{ feat }}</td>
          <td>{{ val }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- D. 特征重要性 -->
  <h5 class="mt-4">模型特征重要性</h5>
  <ul class="list-group mb-5">
    {% for feat, imp in importances_items %}
      <li class="list-group-item d-flex justify-content-between">
        <span>{{ feat }}</span>
        <span>{{ imp }}</span>
      </li>
    {% endfor %}
  </ul>

  <div class="text-center">
    <a href="{{ url_for('audit') }}" class="btn btn-secondary">← 返回 审核</a>
  </div>
</div>
{% endblock %}
